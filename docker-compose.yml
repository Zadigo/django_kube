networks:
  kubes_network:
    driver: bridge

volumes:
  PostgresData:
  NginxLogs:

services:
  app:
    build: ./mykube
    container_name: app_django_kubes
    deploy:
      mode: replicated
      replicas: 1
    env_file:
      - ./docker/environment/django.env
    ports:
      - 8000:8000
    networks:
      - kubes_network

  quart:
    build: ./quart_api
    container_name: app_api_quart
    deploy:
      mode: replicated
      replicas: 1
    env_file:
      - ./docker/environment/quart.env
    ports:
      - 5000:5000
    networks:
      - kubes_network

  reverse-proxy:
    image: traefik:v3.1
    command:
      # - "--log.level=DEBUG"
      - "--api.insecure=true"
      - "--providers.docker=true"
      - "--providers.docker.exposedbydefault=false"
      - "--entryPoints.web.address=:80"
    ports:
      - "80:80"
      - "8080:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - kubes_network

  whoami:
    image: traefik/whoami
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.whoami.rule=Host(`johnpm.fr`)"
      - "traefik.http.routers.whoami.entrypoints=web"
    networks:
      - kubes_network
